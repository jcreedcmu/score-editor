\documentclass{article}
\input{prooftree}
\usepackage{stmaryrd}
\input{linear}
\def\erule#1#2{\begin{prooftree}#1\justifies #2\end{prooftree}}
\def\lpar{\bindnasrepma}
\def\lamp{\binampersand}
\def\bpush{\mathbf{push}}
\newarrow {Equiv} =====
\def\ups{{\uparrow}}
\def\dns{{\downarrow}}

\begin{document}

A regular cache-type is  ${\bf C} = (G, C, B, D, E)$ with morphisms
\[\begin{diagram}
&&G\\
&&\dEmbed<{g}\\
E&\pile{\rTo^{e}\\\rTo_{e'}}&C&\pile{\rTo^{d}\\\rTo_{d'}}&D\\
&&\dOnto<{\pi}\\
&&B\\
\end{diagram}
\]
Where $g$ is the equalizer of $d,d'$ and $\pi$ the coequalizer of $e,e'$. A morphism ${\bf C}_1 \to {\bf C}_2$ is
$f : C_1 \to C_2$ such that $d_2fg_1 = d'_2 f g_1$ and $\pi_2 fe_1 = \pi_2 fe'_1$.

{\bf Fact}: $f$ is a morphism iff we can (uniquely!) find $\ups f$ and $\dns f$ such that

\[\begin{diagram}
&&G_1&\rDotsto^{\ups f}&G_2\\
&&\dEmbed<{g_1}&&\dEmbed>{g_2}\\
E_1&\pile{\rTo^{e_1}\\\rTo_{e'_1}}&C_1&\rTo^{f}&C_2&\pile{\rTo^{d_2}\\\rTo_{d'_2}}&D_2\\
&&\dOnto<{\pi_1}&&\dOnto>{\pi_2}\\
&&B_1&\rDotsto_{\dns f}&B_2\\
\end{diagram}
\]

%% \[
%% \begin{diagram}
%% G_1&\rEmbed^{g_1}&C_1\\
%% \dEmbed<{g_1}&\rdTo>{\ups f}&&\rdTo>f\\
%% C_1&&G_2&\rEmbed^{g_2}&C_2\\
%% &\rdTo<f&\dEmbed<{g_2}&&\dTo>{\delta_2}\\
%% &&C_2&\rTo_{d_2}&D_2\\
%% \end{diagram}
%% \qquad\qquad
%% \begin{diagram}
%% E_1&\rTo^{e_1}&C_1\\
%% \dTo<{\epsilon_1}&&\dOnto>{\pi_1}&\rdTo>f\\
%% C_1&\rOnto_{\pi_1}&B_1&&C_2\\
%% &\rdTo_{f}&&\rdTo>{\dns f}&\dOnto>{\pi_2}\\
%% &&C_2&\rOnto_{\pi_2}&B_2\\
%% \end{diagram}
%% \]

\vskip1em
\hrule
\vskip1em

We might imagine that we have some types
\[
\begin{diagram}
B&\lEquiv&B\\
\uOnto<{\pi}&\ldEmbed~{\iota}&\dTo>d\\
C&\rTo_{\delta}&D\\
\end{diagram}
\qquad\qquad
\begin{diagram}
G &\rEmbed^{g}_{\textrm{[eq'izer]}}&C&\pile{\rTo^{\delta}\\\rTo_{d\circ\pi}}&D
\end{diagram}
\]
These say how to (maybe inefficiently) derive derived state from the base ($d$), and how to derive it (more efficiently)
from state with extra cache ($\delta$), how to project out the base state from the cache state ($\pi$), and
how to create an empty cache ($\iota$). Note that it's not necessarily the case that $d\pi = \delta$ despite the appearance
of the diagram. Then $(G, C, B, D, C)$ is a regular cache-type. Because $\pi$ is split epi, it coequalizes
$1_C$ and $\iota \pi$.


\end{document}
